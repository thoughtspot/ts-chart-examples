import{g as E,C as s,l as d,b as C}from"./number-formatting-70b2729e.js";import"./auto.esm-c3926bfe.js";import{C as v,p as h}from"./chartjs-plugin-datalabels.esm-3e57def8.js";v.register(h);const M="custom-tester-chart-token";function I(e){const t=document.getElementById("tml-string-input").value??"";e.emitEvent(s.SetTMLString,{tmlString:t})}async function A(e){var a;const t=await e.emitEvent(s.GetTMLString),i=document.getElementById("tml-box");i&&t&&(i.innerHTML=`<div>
            <input id="tml-string-input" value="${t.data.tmlString}" />
            <button id="submit-button">Submit</button>
        </div>`),(a=document.getElementById("submit-button"))==null||a.addEventListener("click",()=>{I(e)})}async function w(e){const t=e.getChartModel(),a=(t.config.chartConfig??[]).map(n=>d.reduce(n.dimensions,(o,r)=>({queryColumns:[...o.queryColumns,...r.columns].filter(l=>l.type===C.MEASURE)}),{queryColumns:[]})),u=await e.emitEvent(s.GetDataForQuery,{queries:a});console.log("KPI DATA",u);const{columns:m,dataValue:c}=u.data[0].data,g=document.getElementById("kpi-box");if(g){const n=d.reduce(m,(o,r,l)=>{const p=d.find(t.columns,y=>y.id===r);return d.isNil(p)?o:`${o}<div>${p.name}: ${c[0][l]}</div>`},"");g.innerHTML=`
            <div>${n}</div>
        `}}async function b(e){var t,i,a,u,m,c,g;(t=document.getElementById("open-axis-menu"))==null||t.addEventListener("click",n=>{const r=e.getChartModel().columns.map(l=>l.id);e.emitEvent(s.OpenAxisMenu,{event:{clientX:n.clientX,clientY:n.clientY},columnIds:r,customActions:[{id:"custom-axis-action",label:"Custom axis action",icon:"",onClick:(...l)=>{console.log("custom axis action triggered",l)}}]})}),(i=document.getElementById("open-single-column-menu"))==null||i.addEventListener("click",n=>{const r=e.getChartModel().columns.map(l=>l.id).slice(0,1);e.emitEvent(s.OpenAxisMenu,{event:{clientX:n.clientX,clientY:n.clientY},columnIds:r})}),(a=document.getElementById("close-axis-menu"))==null||a.addEventListener("click",n=>{e.emitEvent(s.CloseAxisMenu)}),(u=document.getElementById("close-context-menu"))==null||u.addEventListener("click",n=>{e.emitEvent(s.CloseContextMenu)}),(m=document.getElementById("show-event-error"))==null||m.addEventListener("click",n=>{e.emitEvent(s.OpenAxisMenu,{event:{clientX:n.clientX,clientY:n.clientY,x:n.x},columnIds:[]})}),(c=document.getElementById("open-context-menu"))==null||c.addEventListener("click",n=>{const r=e.getChartModel().columns.map(l=>l.id);e.emitEvent(s.OpenContextMenu,{event:{clientX:n.clientX,clientY:n.clientY},clickedPoint:{tuple:[{columnId:r[0],value:"x"},{columnId:r[1],value:"y"}]},customActions:[{id:"custom-context-action",label:"Custom context action",icon:"",onClick:(...l)=>{console.log("custom context action triggered",l)}}]})}),(g=document.getElementById("update-visual-props-button"))==null||g.addEventListener("click",n=>{const o=e.getChartModel();typeof(o==null?void 0:o.visualProps)=="object"&&e.emitEvent(s.UpdateVisualProps,{visualProps:{...(o==null?void 0:o.visualProps)||{},clientState:"clientState updated"}})})}async function x(e){const{isLiveboardContext:t=!1}=e.getAppConfig().appOptions;document.getElementById("context-status").style.display="inline",document.getElementById("context-status").textContent+=`${t}`,document.getElementById("context-edit").style.opacity=t?".4":"1"}async function k(e){const{locale:t=window.navigator.language}=e.getAppConfig().localeOptions;document.getElementById("locale-info").style.display="inline",document.getElementById("locale-info").textContent+=`${t}`}async function T(e){const{isPrintMode:t=!1}=e.getAppConfig().appOptions;document.getElementById("printmode-info").style.display="inline",document.getElementById("printmode-info").textContent+=`${t}`}const f=async e=>{try{if(e.getAppConfig().chartAppAccessToken&&e.getAppConfig().chartAppAccessToken!==M)throw new Error("Chart authentication failed.");e.emitEvent(s.RenderStart),await A(e),await w(e),await b(e),await x(e),await k(e),await T(e)}catch(t){e.emitEvent(s.RenderError,{hasError:!0,error:(t==null?void 0:t.message)??"Unknown Error"})}finally{e.emitEvent(s.RenderComplete)}};(async()=>{const e=await E({getDefaultChartConfig:t=>{const i=t.columns,a=d.filter(i,c=>c.type===C.MEASURE);return[{key:"column",dimensions:[{key:"x",columns:[d.filter(i,c=>c.type===C.ATTRIBUTE)[0]]},{key:"y",columns:a.slice(0,2)}]}]},getQueriesFromChartConfig:t=>t.map(a=>d.reduce(a.dimensions,(u,m)=>({queryColumns:[...u.queryColumns,...m.columns]}),{queryColumns:[]})),renderChart:t=>f(t),chartConfigEditorDefinition:[{key:"column",label:"Custom Column",descriptionText:"X Axis can only have attributes, Y Axis can only have measures, Color can only have attributes. Should have just 1 column in Y axis with colors columns.",columnSections:[{key:"x",label:"Custom X Axis",allowAttributeColumns:!0,allowMeasureColumns:!1,allowTimeSeriesColumns:!0,maxColumnCount:1},{key:"y",label:"Custom Y Axis",allowAttributeColumns:!1,allowMeasureColumns:!0,allowTimeSeriesColumns:!1}]}],visualPropEditorDefinition:{elements:[{key:"showError",type:"toggle",defaultValue:!1,label:"Show Error"}]},validateConfig:t=>{if(t.length!==1)return{isValid:!1,validationErrorMessage:["invalid config. no config found"]};const i=t[0].dimensions;return i[0].columns.length===0||i[1].columns.length===0?{isValid:!1,validationErrorMessage:["Invalid config. X or Y axis columns cannot be empty."]}:{isValid:!0}},validateVisualProps:t=>t.showError===!0?{isValid:!1,validationErrorMessage:["Change it to false again!"]}:{isValid:!0},allowedConfigurations:{allowColumnConditionalFormatting:!0,allowColumnNumberFormatting:!0,allowMeasureNamesAndValues:!0}});f(e)})();
