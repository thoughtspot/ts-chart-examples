import{g as E,C as l,l as m,b as C}from"./number-formatting-70b2729e.js";import"./auto.esm-c3926bfe.js";import{C as h,p as v}from"./chartjs-plugin-datalabels.esm-3e57def8.js";h.register(v);const M="custom-tester-chart-token";function I(e){const t=document.getElementById("tml-string-input").value??"";e.emitEvent(l.SetTMLString,{tmlString:t})}async function A(e){var s;const t=await e.emitEvent(l.GetTMLString),o=document.getElementById("tml-box");o&&t&&(o.innerHTML=`<div>
            <input id="tml-string-input" value="${t.data.tmlString}" />
            <button id="submit-button">Submit</button>
        </div>`),(s=document.getElementById("submit-button"))==null||s.addEventListener("click",()=>{I(e)})}async function w(e){const t=e.getChartModel(),s=(t.config.chartConfig??[]).map(d=>m.reduce(d.dimensions,(a,i)=>({queryColumns:[...a.queryColumns,...i.columns].filter(g=>g.type===C.MEASURE)}),{queryColumns:[]})),r=await e.emitEvent(l.GetDataForQuery,{queries:s});console.log("KPI DATA",r);const{columns:u,dataValue:c}=r.data[0].data,n=document.getElementById("kpi-box");if(n){const d=m.reduce(u,(a,i,g)=>{const f=m.find(t.columns,y=>y.id===i);return m.isNil(f)?a:`${a}<div>${f.name}: ${c[0][g]}</div>`},"");n.innerHTML=`
            <div>${d}</div>
        `}}async function x(e){var t,o,s,r,u,c;(t=document.getElementById("open-axis-menu"))==null||t.addEventListener("click",n=>{const a=e.getChartModel().columns.map(i=>i.id);e.emitEvent(l.OpenAxisMenu,{event:{clientX:n.clientX,clientY:n.clientY},columnIds:a,customActions:[{id:"custom-axis-action",label:"Custom axis action",icon:"",onClick:(...i)=>{console.log("custom axis action triggered",i)}}]})}),(o=document.getElementById("open-single-column-menu"))==null||o.addEventListener("click",n=>{const a=e.getChartModel().columns.map(i=>i.id).slice(0,1);e.emitEvent(l.OpenAxisMenu,{event:{clientX:n.clientX,clientY:n.clientY},columnIds:a})}),(s=document.getElementById("close-axis-menu"))==null||s.addEventListener("click",n=>{e.emitEvent(l.CloseAxisMenu)}),(r=document.getElementById("close-context-menu"))==null||r.addEventListener("click",n=>{e.emitEvent(l.CloseContextMenu)}),(u=document.getElementById("show-event-error"))==null||u.addEventListener("click",n=>{e.emitEvent(l.OpenAxisMenu,{event:{clientX:n.clientX,clientY:n.clientY,x:n.x},columnIds:[]})}),(c=document.getElementById("open-context-menu"))==null||c.addEventListener("click",n=>{const a=e.getChartModel().columns.map(i=>i.id);e.emitEvent(l.OpenContextMenu,{event:{clientX:n.clientX,clientY:n.clientY},clickedPoint:{tuple:[{columnId:a[0],value:"x"},{columnId:a[1],value:"y"}]},customActions:[{id:"custom-context-action",label:"Custom context action",icon:"",onClick:(...i)=>{console.log("custom context action triggered",i)}}]})})}async function b(e){const{isLiveboardContext:t=!1}=e.getAppConfig().appOptions;document.getElementById("context-status").style.display="inline",document.getElementById("context-status").textContent+=`${t}`,document.getElementById("context-edit").style.opacity=t?".4":"1"}async function k(e){const{locale:t=window.navigator.language}=e.getAppConfig().localeOptions;document.getElementById("locale-info").style.display="inline",document.getElementById("locale-info").textContent+=`${t}`}async function T(e){const{isPrintMode:t=!1}=e.getAppConfig().appOptions;document.getElementById("printmode-info").style.display="inline",document.getElementById("printmode-info").textContent+=`${t}`}const p=async e=>{try{if(e.getAppConfig().chartAppAccessToken&&e.getAppConfig().chartAppAccessToken!==M)throw new Error("Chart authentication failed.");e.emitEvent(l.RenderStart),await A(e),await w(e),await x(e),await b(e),await k(e),await T(e)}catch(t){e.emitEvent(l.RenderError,{hasError:!0,error:(t==null?void 0:t.message)??"Unknown Error"})}finally{e.emitEvent(l.RenderComplete)}};(async()=>{const e=await E({getDefaultChartConfig:t=>{const o=t.columns,s=m.filter(o,c=>c.type===C.MEASURE);return[{key:"column",dimensions:[{key:"x",columns:[m.filter(o,c=>c.type===C.ATTRIBUTE)[0]]},{key:"y",columns:s.slice(0,2)}]}]},getQueriesFromChartConfig:t=>t.map(s=>m.reduce(s.dimensions,(r,u)=>({queryColumns:[...r.queryColumns,...u.columns]}),{queryColumns:[]})),renderChart:t=>p(t),chartConfigEditorDefinition:[{key:"column",label:"Custom Column",descriptionText:"X Axis can only have attributes, Y Axis can only have measures, Color can only have attributes. Should have just 1 column in Y axis with colors columns.",columnSections:[{key:"x",label:"Custom X Axis",allowAttributeColumns:!0,allowMeasureColumns:!1,allowTimeSeriesColumns:!0,maxColumnCount:1},{key:"y",label:"Custom Y Axis",allowAttributeColumns:!1,allowMeasureColumns:!0,allowTimeSeriesColumns:!1}]}],visualPropEditorDefinition:{elements:[{key:"showError",type:"toggle",defaultValue:!1,label:"Show Error"}]},validateConfig:t=>{if(t.length!==1)return{isValid:!1,validationErrorMessage:["invalid config. no config found"]};const o=t[0].dimensions;return o[0].columns.length===0||o[1].columns.length===0?{isValid:!1,validationErrorMessage:["Invalid config. X or Y axis columns cannot be empty."]}:{isValid:!0}},validateVisualProps:t=>t.showError===!0?{isValid:!1,validationErrorMessage:["Change it to false again!"]}:{isValid:!0},allowedConfigurations:{allowColumnConditionalFormatting:!0,allowColumnNumberFormatting:!0,allowMeasureNamesAndValues:!0}});p(e)})();
