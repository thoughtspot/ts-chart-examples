import{g as p,C as m,l as s,a as g}from"./index-94b3058b.js";import"./auto.esm-c3926bfe.js";import{C as f,p as v}from"./chartjs-plugin-datalabels.esm-3e57def8.js";const y=console;f.register(v);let C;const b=["red","green","blue"],i={0:"color",1:"accordion.Color2",2:"accordion.datalabels"};function d(e,t){const l=s.findIndex(t.columns,o=>e.id===o);return s.map(t.dataValue,o=>o[l])}function E(e,t,l,o){const a=(e==null?void 0:e[0].columns)??[],u=(e==null?void 0:e[1].columns)??[];return{getLabels:()=>d(a[0],t),getDatasets:()=>s.map(u,(n,r)=>({label:n.name,data:d(n,t),yAxisID:`${l}-y${r.toString()}`,type:`${l}`,backgroundColor:s.get(o,i==null?void 0:i[r],b[r]),borderColor:s.get(o,i==null?void 0:i[r],b[r]),datalabels:{anchor:"end"}})),getScales:()=>s.reduce(u,(n,r,c)=>(n[`${l}-y${c.toString()}`]={grid:{display:!0},position:c===0?"left":"right",title:{display:!0,text:`${r.name}`}},n),{}),getPointDetails:(n,r)=>[{columnId:a[0].id,value:d(a[0],t)[n]},{columnId:u[r].id,value:d(u[r],t)[n]}]}}function w(e){var l,o,a;return E(((o=(l=e.config)==null?void 0:l.chartConfig)==null?void 0:o[0].dimensions)??[],((a=e.data)==null?void 0:a[0].data)??[],"bar",e.visualProps)}function x(e){return s.pick(e.native,["clientX","clientY"])}function k(e){const t=e.getChartModel(),l=w(t),o=s.get(t.visualProps,i[2],!1);if(l)try{const a=document.getElementById("chart");a.getContext("2d").clearRect(0,0,a.width,a.height),C=new f(a,{type:"bar",data:{labels:l.getLabels(),datasets:l.getDatasets()},options:{scales:l.getScales(),animation:{duration:0},plugins:{datalabels:{display:o,color:"blue",labels:{title:{font:{weight:"bold"}},value:{color:"green"}}}},maintainAspectRatio:!1,interaction:{mode:"point",intersect:!0},onClick:u=>{const n=u.chart.getActiveElements()[0],r=n.index,c=n.datasetIndex;y.info("ChartPoint",r,c,l.getPointDetails(r,c)),e.emitEvent(m.OpenContextMenu,{event:x(u),clickedPoint:{tuple:l.getPointDetails(r,c)}})}}})}catch(a){throw y.error("renderfailed",a),a}}const h=async e=>{C&&C.destroy();try{e.emitEvent(m.RenderStart),k(e)}catch(t){e.emitEvent(m.RenderError,{hasError:!0,error:t})}finally{e.emitEvent(m.RenderComplete)}};(async()=>{const e=await p({getDefaultChartConfig:t=>{const l=t.columns,o=s.filter(l,n=>n.type===g.MEASURE);return[{key:"column",dimensions:[{key:"x",columns:[s.filter(l,n=>n.type===g.ATTRIBUTE)[0]]},{key:"y",columns:o.slice(0,2)}]}]},getQueriesFromChartConfig:t=>t.map(o=>s.reduce(o.dimensions,(a,u)=>({queryColumns:[...a.queryColumns,...u.columns]}),{queryColumns:[]})),renderChart:t=>h(t),chartConfigEditorDefinition:[{key:"column",label:"Custom Column",descriptionText:"X Axis can only have attributes, Y Axis can only have measures, Color can only have attributes. Should have just 1 column in Y axis with colors columns.",columnSections:[{key:"x",label:"Custom X Axis",allowAttributeColumns:!0,allowMeasureColumns:!1,allowTimeSeriesColumns:!0,maxColumnCount:1},{key:"y",label:"Custom Y Axis",allowAttributeColumns:!1,allowMeasureColumns:!0,allowTimeSeriesColumns:!1}]}],visualPropEditorDefinition:{elements:[{key:"color",type:"radio",defaultValue:"red",values:["red","green","yellow"],label:"Colors"},{type:"section",key:"accordion",label:"Accordion",children:[{key:"Color2",type:"radio",defaultValue:"blue",values:["blue","white","red"],label:"Color2"},{key:"datalabels",type:"toggle",defaultValue:!1,label:"Data Labels"}]}]}});h(e)})();
